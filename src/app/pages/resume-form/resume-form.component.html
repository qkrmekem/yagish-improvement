<div class="resume-form-container">
  <!-- 언어 선택 및 날짜 포맷 설정 (개선점 6) -->
  <div class="header-controls">
    <h1>{{ 'RESUME.TITLE' | translate }}</h1>
    <div class="language-selector">
      <div class="improvement-badge-inline">
        <span class="badge">{{ 'IMPROVEMENT.BADGE' | translate }} 6</span> {{ 'IMPROVEMENT.DATE_FORMAT' | translate }}
      </div>
      <mat-form-field appearance="outline">
        <mat-label>{{ 'RESUME.LANGUAGE_FORMAT' | translate }}</mat-label>
        <mat-select [value]="currentLanguage()" (selectionChange)="changeLanguage($event.value)">
          <mat-option *ngFor="let lang of languages" [value]="lang.code">{{ lang.label }}</mat-option>
        </mat-select>
        <mat-hint>{{ 'RESUME.DATE_FORMAT_EXAMPLE' | translate }}: {{ dateFormats().placeholder }}</mat-hint>
      </mat-form-field>
      <button mat-raised-button color="primary" class="preview-btn" (click)="openPreview()">
        <mat-icon>preview</mat-icon>
        {{ 'COMMON.PREVIEW' | translate }}
      </button>
    </div>
  </div>

  <!-- 개선점 4: 입력폼 / 미리보기 탭 -->
  <div class="improvement-badge">
    <span class="badge">{{ 'IMPROVEMENT.BADGE' | translate }} 4</span> {{ 'IMPROVEMENT.TABS' | translate }}
  </div>

  <mat-tab-group animationDuration="200ms" class="form-tabs">
    <!-- 입력폼 탭 -->
    <mat-tab [label]="'TABS.INPUT' | translate">
      <div class="tab-content">

        <!-- 개선점 3: 세로 스텝퍼 (데스크탑) / 가로 스텝퍼 (모바일) -->
        <div class="improvement-badge">
          <span class="badge">{{ 'IMPROVEMENT.BADGE' | translate }} 3</span> {{ 'IMPROVEMENT.STEPPER' | translate }}
        </div>

        <div class="stepper-layout" [class.vertical]="isVerticalStepper()" [class.horizontal]="!isVerticalStepper()">
          <!-- 스텝퍼 네비게이션 -->
          <nav class="stepper-nav">
            <button
              *ngFor="let step of steps; let i = index"
              class="step-button"
              [class.active]="currentStep() === i"
              [class.completed]="currentStep() > i"
              (click)="goToStep(i)">
              <span class="step-icon">
                <mat-icon *ngIf="currentStep() > i">check</mat-icon>
                <mat-icon *ngIf="currentStep() <= i">{{ step.icon }}</mat-icon>
              </span>
              <span class="step-label">{{ 'STEPS.' + step.labelKey | translate }}</span>
              <span class="step-number">{{ i + 1 }} / {{ steps.length }}</span>
            </button>
          </nav>

          <!-- 동적 컴포넌트 컨테이너 -->
          <div class="step-content">
            <ng-container #stepContainer></ng-container>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- 미리보기 탭 -->
    <mat-tab [label]="'TABS.PREVIEW' | translate">
      <div class="tab-content preview-tab">
        <div class="resume-preview">
          <div class="preview-header">
            <h2>{{ 'RESUME.TITLE' | translate }}</h2>
            <p class="date-display">{{ 'RESUME.WRITE_DATE' | translate }}: {{ formatDate(basicInfoForm.get('resumeDate')?.value) }}</p>
          </div>

          <section class="preview-section">
            <h3>{{ 'STEPS.BASIC_INFO' | translate }}</h3>
            <mat-divider></mat-divider>
            <div class="info-grid">
              <div class="info-item">
                <label>{{ 'BASIC_INFO.NAME' | translate }}</label>
                <span>{{ basicInfoForm.get('name')?.value || ('COMMON.NOT_ENTERED' | translate) }}</span>
              </div>
              <div class="info-item">
                <label>{{ 'BASIC_INFO.EMAIL' | translate }}</label>
                <span>{{ basicInfoForm.get('email')?.value || ('COMMON.NOT_ENTERED' | translate) }}</span>
              </div>
              <div class="info-item">
                <label>{{ 'BASIC_INFO.PHONE' | translate }}</label>
                <span>{{ basicInfoForm.get('phone')?.value || ('COMMON.NOT_ENTERED' | translate) }}</span>
              </div>
              <div class="info-item">
                <label>{{ 'BASIC_INFO.BIRTH_DATE' | translate }}</label>
                <span>{{ formatDate(basicInfoForm.get('birthDate')?.value) || ('COMMON.NOT_ENTERED' | translate) }}</span>
              </div>
            </div>
          </section>

          <section class="preview-section">
            <h3>{{ 'STEPS.EDUCATION' | translate }}</h3>
            <mat-divider></mat-divider>
            <div class="preview-item" *ngFor="let school of schools.controls">
              <strong>{{ school.get('schoolName')?.value || ('EDUCATION.SCHOOL_NAME' | translate) }}</strong>
              <span class="detail">{{ school.get('major')?.value }} ({{ school.get('status')?.value }})</span>
            </div>
          </section>

          <section class="preview-section">
            <h3>{{ 'STEPS.CAREER' | translate }}</h3>
            <mat-divider></mat-divider>
            <div class="preview-item" *ngFor="let career of careers.controls">
              <strong>{{ career.get('companyName')?.value || ('CAREER.COMPANY_NAME' | translate) }}</strong>
              <span class="detail">{{ career.get('position')?.value }}</span>
              <p class="description">{{ career.get('description')?.value }}</p>
            </div>
          </section>

          <section class="preview-section">
            <h3>{{ 'CERTIFICATIONS.TITLE' | translate }}</h3>
            <mat-divider></mat-divider>
            <div class="preview-item" *ngFor="let cert of certifications.controls">
              <strong>{{ cert.get('certName')?.value || ('CERTIFICATIONS.CERT_NAME' | translate) }}</strong>
              <span class="detail">{{ cert.get('issuer')?.value }}</span>
            </div>
          </section>

          <section class="preview-section">
            <h3>{{ 'LANGUAGE_SKILLS.TITLE' | translate }}</h3>
            <mat-divider></mat-divider>
            <div class="preview-item" *ngFor="let lang of languageSkills.controls">
              <strong>{{ lang.get('language')?.value }} - {{ lang.get('examName')?.value }}</strong>
              <span class="detail">{{ 'LANGUAGE_SKILLS.GRADE' | translate }}: {{ lang.get('grade')?.value }} | {{ 'LANGUAGE_SKILLS.SCORE' | translate }}: {{ lang.get('score')?.value }}</span>
            </div>
          </section>

          <section class="preview-section">
            <h3>{{ 'STEPS.SELF_INTRO' | translate }}</h3>
            <mat-divider></mat-divider>
            <div class="text-content">
              <h4>{{ 'SELF_INTRO.MOTIVATION' | translate }}</h4>
              <p>{{ selfIntroForm.get('motivation')?.value || ('COMMON.NOT_ENTERED' | translate) }}</p>
              <h4>{{ 'SELF_INTRO.STRENGTHS' | translate }}</h4>
              <p>{{ selfIntroForm.get('strengths')?.value || ('COMMON.NOT_ENTERED' | translate) }}</p>
            </div>
          </section>
        </div>

        <div class="preview-actions">
          <button mat-raised-button color="primary" (click)="openPreview()">
            <mat-icon>fullscreen</mat-icon> {{ 'COMMON.PREVIEW' | translate }}
          </button>
          <button mat-raised-button color="accent">
            <mat-icon>picture_as_pdf</mat-icon> PDF
          </button>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
